<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Qu·∫£n l√Ω kho QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 10px;
}
#reader {
  width: 100%;
  max-width: 400px;
  margin: auto;
}
select, button {
  font-size: 16px;
  padding: 8px;
  margin: 6px;
}
.warn { color:red; font-weight:bold }
.ok { color:green; font-weight:bold }
</style>
</head>

<body>

<h2>üì¶ Qu·∫£n l√Ω kho QR</h2>

<!-- QU√âT QR -->
<div id="scanScreen">
  <div id="reader"></div>
  <div id="result">Ch∆∞a qu√©t QR</div>
</div>

<!-- K·∫æT QU·∫¢ QR -->
<div id="resultScreen" style="display:none">
  <h3>Th√¥ng tin QR</h3>
  <p id="qrValue"></p>

  <label>H√†nh ƒë·ªông</label><br>
  <select id="action">
    <option value="in">Nh·∫≠p kho</option>
    <option value="out">Xu·∫•t b√°n</option>
    <option value="move">ƒêi·ªÅu chuy·ªÉn</option>
    <option value="check">Ki·ªÉm k√™</option>
  </select><br>

  <label>C·ª≠a h√†ng</label><br>
  <select id="store">
    <option>242</option>
    <option>250</option>
    <option>300</option>
    <option>239</option>
    <option>891</option>
    <option>581</option>
  </select><br>

  <button onclick="saveAction()">üíæ L∆∞u</button>
  <button onclick="location.reload()">üîÅ Qu√©t l·∫°i</button>
</div>

<hr>

<button onclick="showSummary()">üìä K·∫æT QU·∫¢ KI·ªÇM K√ä</button>
<button onclick="showHistory()">üìú L·ªäCH S·ª¨</button>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
/* =========================
   DANH S√ÅCH G·ªêC (ADD SAU)
========================= */
const MASTER = JSON.parse(localStorage.getItem("MASTER") || "[]");

/* =========================
   TI·ªÜN √çCH
========================= */
const today = () => new Date().toISOString().slice(0,10);
const load = k => JSON.parse(localStorage.getItem(k) || "[]");
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

/* =========================
   CAMERA SAU
========================= */
const qr = new Html5Qrcode("reader");
Html5Qrcode.getCameras().then(cams=>{
  const cam = cams.find(c=>c.label.toLowerCase().includes("back")) || cams[cams.length-1];
  qr.start(cam.id,{fps:10,qrbox:250},onScan);
});

function onScan(text){
  qr.stop();
  window.currentQR = text;
  document.getElementById("qrValue").innerHTML = "<b>"+text+"</b>";
  document.getElementById("scanScreen").style.display="none";
  document.getElementById("resultScreen").style.display="block";
}

/* =========================
   L∆ØU H√ÄNH ƒê·ªòNG
========================= */
function saveAction(){
  const action = actionEl.value;
  const store = storeEl.value;

  const history = load("HISTORY");
  history.push({
    qr: currentQR,
    action,
    store,
    time: new Date().toLocaleString()
  });
  save("HISTORY", history);

  if(action!=="out"){
    const check = load("CHECK_"+today());
    check.push({qr:currentQR,store});
    save("CHECK_"+today(),check);
  }

  alert("ƒê√£ l∆∞u ‚úî");
  location.reload();
}

/* =========================
   KI·ªÇM K√ä
========================= */
function showSummary(){
  const checks = load("CHECK_"+today());
  let warn = false;
  let html = "<h3>K·∫æT QU·∫¢ KI·ªÇM K√ä H√îM NAY</h3>";

  MASTER.forEach(x=>{
    if(x.sold) return;
    const found = checks.find(c=>c.qr===x.qr && c.store===x.store);
    if(!found){
      warn = true;
      html += `<div class="warn">üö® ${x.qr} - ${x.store}</div>`;
    }
  });

  if(!warn) html += `<div class="ok">‚úÖ XONG</div>`;
  document.body.innerHTML = html + `<br><button onclick="location.reload()">‚¨Ö Quay l·∫°i</button>`;
}

/* =========================
   L·ªäCH S·ª¨
========================= */
function showHistory(){
  const h = load("HISTORY");
  let html="<h3>L·ªäCH S·ª¨ THAO T√ÅC</h3>";
  h.forEach(x=>{
    html+=`${x.time} | ${x.qr} | ${x.action} | ${x.store}<br>`;
  });
  document.body.innerHTML = html + `<br><button onclick="location.reload()">‚¨Ö Quay l·∫°i</button>`;
}
</script>

</body>
</html>
